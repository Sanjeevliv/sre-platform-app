# Default values for sre-platform.
# This is a YAML-formatted file.

# Common labels
commonLabels:
  app.kubernetes.io/part-of: sre-platform

# API Service Configuration
api:
  replicaCount: 2
  image:
    repository: asia-south1-docker.pkg.dev/sre-portfolio/sre-portfolio-repo/api-service
    pullPolicy: IfNotPresent
    # Overrides the image tag whose default is the chart appVersion.
    tag: "latest"

  service:
    type: ClusterIP
    port: 8080

  resources: 
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    # targetMemoryUtilizationPercentage: 80

  pdb:
    enabled: true
    minAvailable: 1

  # Pod Security Context (Hardening)
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000

  # Container Security Context
  containerSecurityContext:
    allowPrivilegeEscalation: false
    capabilities:
      drop:
      - ALL
    readOnlyRootFilesystem: true

  # Probes (Reliability)
  livenessProbe:
    httpGet:
      path: /healthz
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 10
  readinessProbe:
    httpGet:
      path: /ready
      port: 8080
    initialDelaySeconds: 5
    periodSeconds: 10

# Worker Service Configuration
worker:
  replicaCount: 2
  image:
    repository: asia-south1-docker.pkg.dev/sre-portfolio/sre-portfolio-repo/worker-service
    pullPolicy: IfNotPresent
    tag: "latest"

  resources: 
    limits:
      cpu: 500m
      memory: 256Mi
    requests:
      cpu: 100m
      memory: 128Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 80

  # Worker typically doesn't have an HTTP port exposed for traffic, 
  # but we added metrics on 8081.
  livenessProbe:
    httpGet:
      path: /metrics
      port: 8081
    initialDelaySeconds: 5
    periodSeconds: 10
  
  podSecurityContext:
    runAsNonRoot: true
    runAsUser: 1000

  containerSecurityContext:
    allowPrivilegeEscalation: false
    readOnlyRootFilesystem: true

# Redis (Dependency)
redis:
  enabled: true
  image:
    repository: redis
    tag: alpine
  port: 6379
  resources:
    limits:
      memory: 256Mi
    requests:
      memory: 64Mi

# Monitoring Configuration
monitoring:
  enabled: true
  # SLO Targets
  slo:
    apiAvailability: 99.9
    apiLatencyP99Ms: 300
    workerSuccessRate: 99.5
